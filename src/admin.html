<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - ClaryGuide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4 text-center">Admin Dashboard</h2>
    <div class="row">
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-header bg-primary text-white">All Users</div>
          <div class="card-body">
            <table class="table table-bordered" id="usersTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Provider</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-header bg-success text-white">All Requests</div>
          <div class="card-body">
            <table class="table table-bordered" id="requestsTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Area</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBPgF0eZpGKOt35or9KX7Yx0FqLh2DhZeg",
      authDomain: "claryguide-2e0e6.firebaseapp.com",
      databaseURL: "https://claryguide-2e0e6-default-rtdb.firebaseio.com/",
      projectId: "claryguide-2e0e6",
      storageBucket: "claryguide-2e0e6.firebasestorage.app",
      messagingSenderId: "998554914908",
      appId: "1:998554914908:web:e92af109ff65db87eb5699",
      measurementId: "G-0BWDK4P3LE"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // Show all users
    db.ref('users').on('value', snapshot => {
      const usersTable = document.querySelector('#usersTable tbody');
      usersTable.innerHTML = '';
      const users = snapshot.val();
      if (users) {
        Object.values(users).forEach(user => {
          usersTable.innerHTML += `<tr>
            <td>${user.name || ''}</td>
            <td>${user.email || ''}</td>
            <td>${user.phone || ''}</td>
            <td>${user.provider || ''}</td>
          </tr>`;
        });
      }
    });

    // Show all requests
    db.ref('request').on('value', snapshot => {
      const requestsTable = document.querySelector('#requestsTable tbody');
      requestsTable.innerHTML = '';
      const requests = snapshot.val();
      if (requests) {
        Object.entries(requests).forEach(([key, req]) => {
          requestsTable.innerHTML += `<tr>
            <td>${req.name || ''}</td>
            <td>${req.email || ''}</td>
            <td>${req.date || ''}</td>
            <td>${req.timeSlot || ''}</td>
            <td>${req.area || ''}</td>
            <td id="status-${key}">${req.status || 'Pending'}</td>
            <td>
              <button class="btn btn-success btn-sm" onclick="updateRequestStatus('${key}', 'Accepted')">Accept</button>
              <button class="btn btn-danger btn-sm" onclick="updateRequestStatus('${key}', 'Rejected')">Reject</button>
            </td>
          </tr>`;
        });
      }
    });

    // Update request status
    window.updateRequestStatus = function(key, status) {
      db.ref('request/' + key).update({ status });
      document.getElementById('status-' + key).innerText = status;
    };
  </script>
</body>
</html>
